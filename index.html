<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApexFish Terminal v5.0</title>
    <style>
        /* --- CORE TERMINAL STYLES --- */
        body {
            background-color: #050505;
            color: #00ff00;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        #terminal-output {
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }
        #input-line {
            display: flex;
            border-top: 1px solid #333;
            padding-top: 10px;
            background: #050505;
        }
        #prompt {
            color: #00ff00;
            margin-right: 10px;
            font-weight: bold;
        }
        #cmd {
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            flex-grow: 1;
            outline: none;
        } 
        
        /* --- UI ELEMENTS --- */
        .result-card {
            border: 1px solid #333;
            background: #0a0a0a;
            border-left: 4px solid #00ff00;
            padding: 12px;
            margin-top: 10px;
            margin-bottom: 5px;
            width: fit-content;
            min-width: 280px;
        }
        
        .result-header {
            font-size: 12px;
            color: #ffffff; 
            font-weight: bold;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-grid {
            display: flex;
            gap: 30px; 
            margin-bottom: 12px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }
        
        .stat-label {
            font-size: 11px;
            color: #cccccc; 
            margin-bottom: 2px;
        }
        
        .stat-value {
            font-size: 15px;
            font-weight: bold;
            color: #00ff00;
        }

        .action-box {
            background: #0d1a0d;
            border: 1px solid #004400;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #00ff00;
            text-transform: uppercase;
            border-radius: 4px;
            letter-spacing: 1px;
        }
        
        .radar-container {
            margin-top: 5px;
            margin-bottom: 15px;
            padding: 10px;
            display: inline-block;
            border: 1px solid #222;
            background: #0a0a0a;
            border-radius: 4px;
        }
        .radar-label {
            font-size: 11px;
            color: #aaaaaa; 
            margin-bottom: 8px;
            text-align: center;
            letter-spacing: 1px;
        }
        .radar-grid {
            display: grid;
            grid-template-columns: repeat(3, 40px);
            grid-template-rows: repeat(3, 40px);
            gap: 6px;
        }
        .cell {
            width: 40px;
            height: 40px;
            background: #111;
            border: 1px solid #333;
            border-radius: 2px;
            transition: all 0.2s ease;
        }
        
        .cell.target { border: 2px solid #00ff00; box-shadow: inset 0 0 5px rgba(0,255,0,0.2); }
        .cell.possible { border: 2px dashed #ffff00; opacity: 0.8; } 
        .cell.hit { background-color: #00ff00; border: 2px solid #00ff00; box-shadow: 0 0 15px rgba(0,255,0,0.6); }

    </style>
</head>
<body>

    <div id="terminal-output">
        <div style="font-size: 16px; font-weight: 900; color: #00ff00; margin-bottom: 10px; letter-spacing: 1px;">
            RIVAL'S GIGA FISH TOOL 
        </div>
        
        <div style="color: #00ff00; font-weight: bold;">
            [!] GIGAMIND: Input fish location (0-8)
        </div>
        <br>
    </div>

    <div id="input-line">
        <span id="prompt">root@giga:~$</span>
        <input type="text" id="cmd" autofocus autocomplete="off">
    </div>

<script>
    class ApexFish {
        constructor() {
            this.adj = {
                0: new Set([0, 1, 3]), 1: new Set([0, 1, 2, 4]), 2: new Set([1, 2, 5]),
                3: new Set([0, 3, 4, 6]), 4: new Set([1, 3, 4, 5, 7]), 
                5: new Set([2, 4, 5, 8]), 6: new Set([3, 6, 7]), 7: new Set([4, 6, 7, 8]), 8: new Set([5, 7, 8])
            };
            this.history = [];
            
            // Standard Meta Spells (Defaults)
            this.CROSS = new Set([1, 3, 4, 5, 7]);
            this.CLUSTERS = {
                0: new Set([0, 1, 3, 4]), 2: new Set([1, 2, 4, 5]),
                6: new Set([3, 4, 6, 7]), 8: new Set([4, 5, 7, 8])
            };
            this.ROWS = {0: new Set([0, 1, 2]), 3: new Set([3, 4, 5]), 6: new Set([6, 7, 8])};
        }

        print(text, color = "#00ff00") {
            const output = document.getElementById('terminal-output');
            const line = document.createElement('div');
            line.style.color = color;
            line.innerHTML = text; 
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        printRaw(html) {
            const output = document.getElementById('terminal-output');
            const line = document.createElement('div');
            line.innerHTML = html;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        intersect(setA, setB) {
            return new Set([...setA].filter(x => setB.has(x)));
        }

        drawRadar(targetCells, possibleCells) {
            let html = `
            <div class="radar-container">
                <div class="radar-label">TARGETING HUD</div>
                <div class="radar-grid">
            `;
            for (let i = 0; i < 9; i++) {
                let classes = 'cell';
                if (targetCells.has(i) && possibleCells.has(i)) classes += ' hit';
                else if (targetCells.has(i)) classes += ' target';
                else if (possibleCells.has(i)) classes += ' possible';
                html += `<div class="${classes}"></div>`;
            }
            html += `</div></div>`;
            this.printRaw(html);
        }

        solve(pos) {
            // Reset logic if move is impossible
            if (this.history.length > 0) {
                const lastPos = this.history[this.history.length - 1];
                if (!this.adj[lastPos].has(pos)) {
                    this.print(`[!] MOVEMENT IMPOSSIBLE (${lastPos} -> ${pos})`, "orange");
                    this.print("[!] NEW FISH DETECTED. RESETTING...", "orange");
                    this.history = [];
                }
            }
            this.history.push(pos);
            if (this.history.length > 4) this.history.shift();

            const possible = new Set(this.adj[pos]);
            let volatility = "LOW";

            // Anti-Backtrack Logic
            if (this.history.length >= 2) {
                const prevPos = this.history[this.history.length - 2];
                if (possible.has(prevPos) && this.history.length > 2) {
                    volatility = (this.history[this.history.length - 1] !== this.history[this.history.length - 3]) 
                        ? "HIGH" : "MODERATE";
                }
            }

            // AUTO-SELECT BEST SPELL (No Deck Check)
            let spellName = "";
            let spellTiles = new Set();

            if (pos === 4) {
                spellName = "CROSS SPELL";
                spellTiles = this.CROSS;
            } else if (this.CLUSTERS[pos]) {
                spellName = "2x2 CLUSTER";
                spellTiles = this.CLUSTERS[pos];
            } else {
                let rowStart = Math.floor(pos / 3) * 3;
                spellName = "3x1 HORIZONTAL";
                spellTiles = this.ROWS[rowStart];
            }

            const hits = this.intersect(spellTiles, possible).size;
            let baseConf = (hits / possible.size) * 100;
            let finalConf = volatility === "LOW" ? baseConf : baseConf - 10;

            // Direct Recommendation
            let recommendation = `CAST ${spellName}`;

            // RENDER RESULT
            const resultHtml = `
            <div class="result-card">
                <div class="result-header">ANALYSIS: POSITION ${pos}</div>
                <div class="stat-grid">
                    <div class="stat-item">
                        <span class="stat-label">VOLATILITY</span>
                        <span class="stat-value" style="color: ${volatility === 'HIGH' ? 'orange' : '#00ff00'}">${volatility}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">CONFIDENCE</span>
                        <span class="stat-value">${finalConf.toFixed(1)}%</span>
                    </div>
                </div>
                <div class="action-box">
                    ${recommendation}
                </div>
            </div>
            `;
            
            this.printRaw(resultHtml);
            this.drawRadar(spellTiles, possible);
        }
    }

    const bot = new ApexFish();
    const input = document.getElementById('cmd');

    input.addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            const val = input.value.trim();
            input.value = '';
            
            bot.printRaw(`<div style="color: #666; margin-top: 5px;">> ${val}</div>`);

            // SIMPLIFIED COMMANDS
            if (val.toLowerCase() === 'reset') {
                bot.history = [];
                bot.print("History Cleared.", "orange");
                return;
            }
            if (val.toLowerCase() === 'exit') {
                bot.print("Session Terminated.", "red");
                return;
            }
            
            if (!isNaN(parseInt(val)) && parseInt(val) >= 0 && parseInt(val) <= 8) {
                bot.solve(parseInt(val));
            } else {
                // If they type anything else, just remind them gently
                bot.print("[!] GIGAMIND: Input fish location (0-8)", "yellow");
            }
        }
    });

    document.addEventListener('click', () => input.focus());
</script>
</body>
</html>
